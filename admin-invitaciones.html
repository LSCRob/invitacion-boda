<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sistema de Invitaciones - Boda</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    :root {
      --verde-olivo-oscuro: #6f5c23;
      --dorado: #fce837;
      --beige: #fffad2;
    }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: var(--beige);
      color: var(--verde-olivo-oscuro);
      padding: 20px;
    }
    .container {
      max-width: 1000px;
      margin: 0 auto;
      background: white;
      padding: 30px;
      border-radius: 15px;
      box-shadow: 0 0 20px rgba(0,0,0,0.1);
    }
    h1, h2, h3 {
      color: var(--verde-olivo-oscuro);
      font-weight: 700;
    }
    .header {
      text-align: center;
      margin-bottom: 30px;
      padding-bottom: 20px;
      border-bottom: 2px solid var(--dorado);
    }
    .btn-primary {
      background-color: var(--verde-olivo-oscuro);
      border-color: var(--verde-olivo-oscuro);
    }
    .btn-primary:hover {
      background-color: #2c3817;
      border-color: #2c3817;
    }
    .invitacion-card {
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 15px;
      background-color: #f9f9f9;
    }
    .link-invitacion {
      word-break: break-all;
      color: var(--verde-olivo-oscuro);
      font-weight: 500;
    }
    .badge {
      font-size: 0.9em;
    }
    .form-label {
      font-weight: 600;
    }
    #listaInvitaciones {
      max-height: 400px;
      overflow-y: auto;
    }
    .copied-message {
      display: none;
      color: green;
      font-weight: 600;
      margin-left: 10px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>Sistema de Invitaciones - Boda</h1>
      <p class="lead">Genera enlaces únicos para cada invitado</p>
    </div>

    <div class="row">
      <div class="col-md-6">
        <div class="card mb-4">
          <div class="card-header">
            <h3>Crear Nueva Invitación</h3>
          </div>
          <div class="card-body">
            <form id="formInvitacion">
              <div class="mb-3">
                <label for="nombreInvitado" class="form-label">Nombre del Invitado</label>
                <input type="text" class="form-control" id="nombreInvitado" required>
              </div>
              <div class="mb-3">
                <label for="emailInvitado" class="form-label">Email (opcional)</label>
                <input type="email" class="form-control" id="emailInvitado">
              </div>
              <div class="mb-3 form-check">
                <input type="checkbox" class="form-check-input" id="permiteAcompanante">
                <label class="form-check-label" for="permiteAcompanante">Permitir acompañante</label>
              </div>
              <div class="mb-3">
                <label for="mensajePersonalizado" class="form-label">Mensaje personalizado (opcional)</label>
                <textarea class="form-control" id="mensajePersonalizado" rows="2"></textarea>
              </div>
              <button type="submit" class="btn btn-primary">Generar Enlace de Invitación</button>
            </form>
          </div>
        </div>
      </div>

      <div class="col-md-6">
        <div class="card">
          <div class="card-header">
            <h3>Invitaciones Generadas</h3>
          </div>
          <div class="card-body">
            <div id="listaInvitaciones">
              <p class="text-center" id="mensajeVacio">No hay invitaciones generadas todavía.</p>
              <!-- Las invitaciones se agregarán aquí dinámicamente -->
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="mt-4">
      <div class="card">
        <div class="card-header">
          <h3>Configuración de la Invitación</h3>
        </div>
        <div class="card-body">
          <div class="mb-3">
            <label for="https://lscrob.github.io/invitacion-boda/invitaciones.html?id=" class="form-label">URL Base para las invitaciones</label>
            <input type="text" class="form-control" id="https://lscrob.github.io/invitacion-boda/invitaciones.html?id=" value="https://mi-boda.com/invitacion/" required>
            <div class="form-text">Esta será la base para todos los enlaces de invitación.</div>
          </div>
          <button id="btnGuardarConfig" class="btn btn-primary">Guardar Configuración</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Cargar invitaciones desde localStorage
      cargarInvitaciones();
      
      // Configurar el formulario
      document.getElementById('formInvitacion').addEventListener('submit', function(e) {
        e.preventDefault();
        crearInvitacion();
      });
      
      // Configurar botón de guardar configuración
      document.getElementById('btnGuardarConfig').addEventListener('click', function() {
        guardarConfiguracion();
      });
      
      // Cargar configuración
      const config = JSON.parse(localStorage.getItem('configInvitaciones')) || {};
      if (config.urlBase) {
        document.getElementById('https://lscrob.github.io/invitacion-boda/invitaciones.html?id=').value = config.urlBase;
      }
    });

    function crearInvitacion() {
      const nombre = document.getElementById('nombreInvitado').value;
      const email = document.getElementById('emailInvitado').value;
      const permiteAcompanante = document.getElementById('permiteAcompanante').checked;
      const mensajePersonalizado = document.getElementById('mensajePersonalizado').value;
      
      // Generar ID único
      const id = generarIdUnico();
      
      // Obtener URL base
      const urlBase = document.getElementById('https://lscrob.github.io/invitacion-boda/invitaciones.html?id=').value;
      const enlace = urlBase + id;
      
      // Crear objeto de invitación
      const invitacion = {
        id,
        nombre,
        email,
        permiteAcompanante,
        mensajePersonalizado,
        enlace,
        fechaCreacion: new Date().toISOString(),
        confirmado: false,
        asistentes: 1
      };
      
      // Guardar en localStorage
      guardarInvitacion(invitacion);
      
      // Mostrar en la lista
      agregarInvitacionALista(invitacion);
      
      // Limpiar formulario
      document.getElementById('formInvitacion').reset();
      
      // Mostrar mensaje de éxito
      alert(`Invitación creada para ${nombre}. El enlace ha sido copiado al portapapeles.`);
      
      // Copiar al portapapeles
      copiarAlPortapapeles(enlace);
    }

    function generarIdUnico() {
      return Math.random().toString(36).substring(2, 10) + Math.random().toString(36).substring(2, 10);
    }

    function guardarInvitacion(invitacion) {
      // Obtener invitaciones existentes
      const invitaciones = JSON.parse(localStorage.getItem('invitacionesBoda')) || [];
      
      // Agregar nueva invitación
      invitaciones.push(invitacion);
      
      // Guardar en localStorage
      localStorage.setItem('invitacionesBoda', JSON.stringify(invitaciones));
    }

    function cargarInvitaciones() {
      const invitaciones = JSON.parse(localStorage.getItem('invitacionesBoda')) || [];
      const lista = document.getElementById('listaInvitaciones');
      const mensajeVacio = document.getElementById('mensajeVacio');
      
      if (invitaciones.length === 0) {
        mensajeVacio.style.display = 'block';
        return;
      }
      
      mensajeVacio.style.display = 'none';
      
      // Limpiar lista
      while (lista.firstChild) {
        lista.removeChild(lista.firstChild);
      }
      
      // Agregar cada invitación
      invitaciones.forEach(invitacion => {
        agregarInvitacionALista(invitacion);
      });
    }

    function agregarInvitacionALista(invitacion) {
      const lista = document.getElementById('listaInvitaciones');
      const mensajeVacio = document.getElementById('mensajeVacio');
      
      if (mensajeVacio.style.display !== 'none') {
        mensajeVacio.style.display = 'none';
      }
      
      const div = document.createElement('div');
      div.className = 'invitacion-card';
      div.innerHTML = `
        <h5>${invitacion.nombre} ${invitacion.email ? `(${invitacion.email})` : ''}</h5>
        <p class="link-invitacion">${invitacion.enlace}</p>
        <div class="d-flex justify-content-between align-items-center">
          <span class="badge ${invitacion.confirmado ? 'bg-success' : 'bg-secondary'}">
            ${invitacion.confirmado ? 'Confirmado' : 'Pendiente'}
          </span>
          <div>
            <button class="btn btn-sm btn-outline-primary btn-copiar" data-enlace="${invitacion.enlace}">Copiar</button>
            <button class="btn btn-sm btn-outline-danger btn-eliminar" data-id="${invitacion.id}">Eliminar</button>
          </div>
        </div>
        <div class="copied-message">¡Copiado!</div>
      `;
      
      lista.appendChild(div);
      
      // Añadir evento al botón copiar
      div.querySelector('.btn-copiar').addEventListener('click', function() {
        const enlace = this.getAttribute('data-enlace');
        copiarAlPortapapeles(enlace);
        
        // Mostrar mensaje de copiado
        const msg = this.parentElement.nextElementSibling;
        msg.style.display = 'inline';
        setTimeout(() => {
          msg.style.display = 'none';
        }, 2000);
      });
      
      // Añadir evento al botón eliminar
      div.querySelector('.btn-eliminar').addEventListener('click', function() {
        const id = this.getAttribute('data-id');
        eliminarInvitacion(id);
      });
    }

    function copiarAlPortapapeles(texto) {
      navigator.clipboard.writeText(texto).then(() => {
        console.log('Enlace copiado al portapapeles');
      }).catch(err => {
        console.error('Error al copiar: ', err);
        // Método alternativo para navegadores más antiguos
        const textArea = document.createElement('textarea');
        textArea.value = texto;
        document.body.appendChild(textArea);
        textArea.select();
        document.execCommand('copy');
        document.body.removeChild(textArea);
      });
    }

    function eliminarInvitacion(id) {
      if (confirm('¿Estás seguro de que quieres eliminar esta invitación?')) {
        let invitaciones = JSON.parse(localStorage.getItem('invitacionesBoda')) || [];
        invitaciones = invitaciones.filter(inv => inv.id !== id);
        localStorage.setItem('invitacionesBoda', JSON.stringify(invitaciones));
        cargarInvitaciones();
      }
    }

    function guardarConfiguracion() {
      const urlBase = document.getElementById('https://lscrob.github.io/invitacion-boda/invitaciones.html?id=').value;
      localStorage.setItem('configInvitaciones', JSON.stringify({ urlBase }));
      alert('Configuración guardada correctamente.');
    }
  </script>
</body>
</html>